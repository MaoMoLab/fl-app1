# 添加简洁登录页面

**日期**: 2025年11月21日  
**操作**: 创建简洁登录页面并在主页添加入口

## 变更概述

为解决自动填充密码功能问题，创建了一个最精简的登录页面，并在主页添加了登录按钮。

## 文件变更

### 1. 新建文件

#### `/lib/page/auth/login/auth_simple_login_page.dart`

创建了简洁登录页面 `AuthSimpleLoginPage`，主要特点：

- ✅ **自动填充支持**: 使用 `AutofillGroup` 和 `autofillHints` 实现密码管理器自动填充
- ✅ **最精简实现**: 只包含必要的邮箱和密码字段
- ✅ **表单验证**: 邮箱格式验证和密码长度验证
- ✅ **API 调用规范**: 使用 Model 参数调用登录 API
- ✅ **状态管理**: 使用单例 `AuthStore` 管理认证状态
- ✅ **用户体验**: 加载状态显示、错误提示、成功提示

**核心代码特性**:

```dart
// 1. 自动填充支持
AutofillGroup
(
child: Form(
child: Column(
children: [
TextFormField(
autofillHints: const [AutofillHints.email],
// ...
),
TextFormField(
autofillHints: const [AutofillHints.password],
// ...
),
],
),
),
)

// 2. 使用 Model 参数调用 API（符合规范）
final body = WebSubFastapiRoutersApiVAuthAccountLoginIndexParamsModel(
email: _emailController.text.trim(),
password: _passwordController.text,
captchaKey: _captchaKey,
tiago2CapToken: 'auto_${DateTime.now().millisecondsSinceEpoch}',
isRememberMe: true,
);

// 3. 完成自动填充保存
TextInput.
finishAutofillContext
(
shouldSave
:
true
);
```

### 2. 修改文件

#### `/lib/router/index.dart`

**变更内容**:

- 导入 `auth_simple_login_page.dart`
- 添加路由 `/auth/simple_login`

```dart
GoRoute
(
path: '/auth/simple_login',
name: 'auth_simple_login',
builder: (context, state) => const AuthSimpleLoginPage
(
)
,
)
,
```

#### `/lib/page/home_page.dart`

**变更内容**:

- 在主页顶部添加"简洁登录"按钮

```dart
ElevatedButton
(
onPressed: () => context.go('/auth/simple_login'),
child: const Text('简洁登录'
)
,
)
,
```

## 功能说明

### 自动填充密码功能

通过以下方式实现浏览器/系统密码管理器的自动填充：

1. **AutofillGroup**: 将表单包装在 `AutofillGroup` 中
2. **autofillHints**: 为输入框指定提示类型
    - `AutofillHints.email` - 邮箱字段
    - `AutofillHints.password` - 密码字段
3. **finishAutofillContext**: 登录成功后保存凭据

### 登录流程

1. 用户输入邮箱和密码（或使用自动填充）
2. 点击"登录"按钮或按回车键
3. 表单验证通过后发起 API 请求
4. 使用 `RestClient` 调用登录接口
5. 成功后保存 Token 到 `AuthStore`
6. 提示用户并跳转到用户仪表板

### 路由路径

- **简洁登录页**: `/auth/simple_login`
- **完整登录页**: `/auth/login`

## 代码规范遵循

✅ 未使用 `try-catch` 包装无意义报错  
✅ 代码最大化精简实现功能  
✅ 未修改 `/lib/api` 下的自动生成代码  
✅ 使用 Model 参数调用 API，避免手动构造 query string  
✅ 使用单例模式 `AuthStore()` 管理全局状态  
✅ 类命名使用大驼峰：`AuthSimpleLoginPage`  
✅ 文件命名使用小写+下划线：`auth_simple_login_page.dart`  
✅ 变量命名使用小驼峰，布尔值使用 `_is` 前缀  
✅ 所有字段声明类型，包括泛型  
✅ Widget 构造方法使用命名可选参数  
✅ 使用 `const` 优化性能

## 测试建议

1. 在浏览器中测试自动填充功能
2. 验证表单验证逻辑
3. 测试登录成功/失败的不同场景
4. 检查 Token 是否正确保存到 AuthStore
5. 验证登录后跳转到用户仪表板

## 后续优化建议

1. 可以添加"记住我"选项（当前默认为 true）
2. 可以添加"忘记密码"链接
3. 可以添加第三方登录选项
4. 可以添加双因素认证支持

