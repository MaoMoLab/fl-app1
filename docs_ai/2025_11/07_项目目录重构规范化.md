# 项目目录重构规范化

**日期**: 2025年11月07日  
**操作**: 按照Flutter开发规范重组项目目录结构

## 一、重构概述

根据项目开发规范，将 `/lib` 目录下的所有文件（除 `/lib/api` 自动生成代码外）进行了全面重组，采用更清晰的目录结构和命名规范。

## 二、新目录结构

```
/lib
├── /api                    # API 自动生成代码（未修改）
├── /page                   # 页面落地页（原 pages）
│   ├── /auth
│   │   └── /login
│   │       └── auth_login_page.dart (AuthLoginPage)
│   ├── /user
│   │   └── /dashboard
│   │       └── user_dashboard_page.dart (UserDashboardPage)
│   ├── /low_admin
│   │   ├── /home
│   │   │   └── low_admin_home_page.dart (LowAdminHomePage)
│   │   ├── /users_list
│   │   │   └── low_admin_users_list_page.dart (LowAdminUsersListPage)
│   │   ├── /user_detail
│   │   │   └── low_admin_user_detail_page.dart (LowAdminUserDetailPage)
│   │   ├── /user_pay_list
│   │   │   └── low_admin_user_pay_list_page.dart (LowAdminUserPayListPage)
│   │   ├── /user_bought_list
│   │   │   └── low_admin_user_bought_list_page.dart (LowAdminUserBoughtListPage)
│   │   ├── /user_pay_records
│   │   │   └── low_admin_user_pay_records_page.dart (LowAdminUserPayRecordsPage)
│   │   ├── /user_bought_records
│   │   │   └── low_admin_user_bought_records_page.dart (LowAdminUserBoughtRecordsPage)
│   │   ├── /user_money_recharge
│   │   │   └── low_admin_user_money_recharge_page.dart (LowAdminUserMoneyRechargePage)
│   │   ├── /settings
│   │   │   └── low_admin_settings_page.dart (LowAdminSettingsPage)
│   │   └── low_admin_layout.dart
│   ├── /debug
│   │   └── /version
│   │       └── debug_version_page.dart (DebugVersionPage)
│   ├── /system
│   │   └── system_view_default_const_page.dart (SystemViewDefaultConstPage)
│   └── home_page.dart
│
├── /component              # 通用组件（原 widgets）
│   ├── /layout
│   │   ├── simple_layout_with_menu_component.dart (SimpleLayoutWithMenuComponent)
│   │   ├── user_layout_component.dart (UserLayoutComponent)
│   │   ├── user_menu_component.dart
│   │   ├── user_sidebar_component.dart (UserSidebarComponent, UserNavigationRailComponent)
│   │   └── simple_user_menu_component.dart
│   ├── /auth
│   │   └── auth_status_component.dart (AuthStatusComponent)
│   ├── /dashboard
│   │   ├── announcement_card_component.dart (AnnouncementCardComponent)
│   │   ├── status_card_component.dart (StatusCardComponent)
│   │   ├── subscription_card_component.dart (SubscriptionCardComponent)
│   │   └── traffic_card_component.dart (TrafficCardComponent)
│   └── /low_admin
│       ├── editable_user_v2_info_card_component.dart (EditableUserV2InfoCardComponent)
│       ├── editable_user_old_service_card_component.dart (EditableUserOldServiceCardComponent)
│       ├── user_v2_info_card_component.dart (UserV2InfoCardComponent)
│       ├── user_old_service_card_component.dart (UserOldServiceCardComponent)
│       └── user_money_card_component.dart (UserMoneyCardComponent)
│
├── /store                  # 数据集中管理（原 utils/auth + types）
│   ├── /model
│   │   ├── jwt_token_model.dart
│   │   ├── subscription_model.dart
│   │   └── index.dart
│   ├── /service
│   │   └── /auth
│   │       ├── auth_store.dart
│   │       ├── auth_constants.dart
│   │       ├── auth_interceptor.dart
│   │       ├── authenticated_client.dart
│   │       └── auth_export.dart
│   └── index.dart
│
├── /helper                 # 公共方法（原 utils）
│   ├── format_helper.dart
│   ├── clipboard_helper.dart
│   ├── subscription_helper.dart
│   └── index.dart
│
├── /config                 # 配置中心
│
├── /router                 # 路由（原 routes.dart）
│   ├── index.dart (原 routes.dart)
│   ├── user_routes.dart
│   ├── low_admin_routes.dart
│   └── system_routes.dart
│
└── main.dart
```

## 三、命名规范

### 3.1 文件命名
- **必须使用小写+下划线**命名
- 页面文件后缀：`_page.dart`
- 组件文件后缀：`_component.dart`
- 辅助工具后缀：`_helper.dart`
- 数据模型后缀：`_model.dart`

### 3.2 类命名
- **页面类**：`[模块][功能]Page`
  - 例：`AuthLoginPage`, `UserDashboardPage`, `LowAdminUsersListPage`
- **组件类**：`[功能]Component`
  - 例：`TrafficCardComponent`, `AuthStatusComponent`
- **辅助类**：保持原有命名，如 `AuthStore`

### 3.3 目录命名
- 使用小写+下划线
- 模块化分组，每个页面独立文件夹
- 通用功能放在对应的顶层目录

## 四、主要变更

### 4.1 目录重组
1. `pages/` → `page/` - 页面目录
2. `widgets/` → `component/` - 组件目录
3. `utils/` → `helper/` + `store/service/` - 工具拆分
4. `types/` → `store/model/` - 类型定义
5. `routes.dart` → `router/index.dart` - 路由配置

### 4.2 类名更新
所有类名都按照新规范进行了重命名：
- `LoginPage` → `AuthLoginPage`
- `DashboardPage` → `UserDashboardPage`
- `VersionPage` → `DebugVersionPage`
- `UserV2Page` → `LowAdminUserDetailPage`
- `UsersListPage` → `LowAdminUsersListPage`
- `SimpleLayoutWithMenu` → `SimpleLayoutWithMenuComponent`
- `TrafficCard` → `TrafficCardComponent`
- `AuthStatusWidget` → `AuthStatusComponent`
- 等等...

### 4.3 导入路径更新
所有文件的导入路径已更新为使用绝对路径：
```dart
// 旧
import '../pages/home_page.dart';
import '../../widgets/user_layout.dart';

// 新
import 'package:fl_app1/page/home_page.dart';
import 'package:fl_app1/component/layout/user_layout_component.dart';
```

### 4.4 代码清理
- 删除了重复的 `formatBytes` 函数（clipboard_helper 中）
- 修复了所有导入引用
- 添加了 library 文档注释
- 删除了未使用的方法（如 `_buildBoolInfoRow`）

## 五、关键文件修改

### 5.1 路由配置
- `lib/router/index.dart` - 主路由配置
- `lib/router/user_routes.dart` - 用户路由
- `lib/router/low_admin_routes.dart` - 管理后台路由
- `lib/router/system_routes.dart` - 系统路由

### 5.2 认证服务
- `lib/store/service/auth/auth_store.dart` - 认证状态管理
- `lib/store/service/auth/auth_interceptor.dart` - HTTP拦截器
- `lib/store/service/auth/authenticated_client.dart` - 认证客户端

### 5.3 公共辅助
- `lib/helper/format_helper.dart` - 格式化工具
- `lib/helper/clipboard_helper.dart` - 剪贴板工具
- `lib/helper/subscription_helper.dart` - 订阅处理工具

## 六、分析结果

执行 `flutter analyze` 结果：
- **0个错误** ✅
- 19个信息提示（主要是测试文件中的 print 语句）
- 所有主要代码编译通过

## 七、最佳实践遵循

✅ 使用小写+下划线文件命名  
✅ 使用大驼峰类命名  
✅ 清晰的模块化目录结构  
✅ 统一的组件和页面后缀  
✅ 绝对路径导入  
✅ 避免代码重复  
✅ 符合 Flutter 官方代码规范  

## 八、后续建议

1. **配置目录**：可以添加 `/lib/config` 目录存放应用配置
2. **常量导出**：创建 `constants.dart` 统一导出所有常量
3. **资源管理**：考虑使用 `flutter_asset_generator` 生成资源常量
4. **状态管理**：如需要可以添加 `/lib/store/provider` 用于 Provider 状态

## 九、迁移检查清单

- [x] 所有页面文件已移动并重命名
- [x] 所有组件文件已移动并重命名
- [x] 所有工具类已重组
- [x] 所有导入路径已更新
- [x] 路由配置已更新
- [x] 类名已统一规范
- [x] 删除旧目录结构
- [x] 代码格式化完成
- [x] Flutter analyze 通过
- [x] 测试文件已修复

## 十、注意事项

⚠️ **API 目录未修改**：`/lib/api` 下的所有代码为自动生成，未做任何修改。

⚠️ **向后兼容**：旧的导入路径已全部失效，需要更新所有引用。

⚠️ **测试更新**：测试文件的导入路径也需要相应更新。

---

**完成时间**: 2025年11月07日 14:10  
**执行者**: AI Assistant  
**状态**: ✅ 完成

