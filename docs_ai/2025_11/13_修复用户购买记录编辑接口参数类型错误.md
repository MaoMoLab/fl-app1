# 修复用户购买记录编辑接口参数类型错误

## 问题描述

在 `low_admin_user_bought_records_page.dart` 中，编辑购买记录时出现类型错误：

```
lib/page/low_admin/user_bought_records/low_admin_user_bought_records_page.dart:205:21: Error: The argument type 'int' can't be assigned to the parameter type 'String'.
  boughtId: boughtIdInt,
            ^
```

## 问题原因

API 接口定义的参数类型不一致：

1. **DELETE 接口**：`deleteUserBoughtApiV2LowAdminApiUserBoughtBoughtIdDelete` 期望 `boughtId` 为 `int` 类型
2. **PUT 接口**：`putUserBoughtApiV2LowAdminApiUserBoughtBoughtIdPut` 期望 `boughtId` 为 `String` 类型

而 `record.id` 本身就是 `String` 类型，代码中错误地将其转换为 `int` 后传递给 PUT 接口。

## 解决方案

### 修改内容

在 `_editBoughtRecord` 方法中：

**修改前：**

```dart

final boughtIdInt = int.tryParse(record.id);if (
boughtIdInt == null) {
if (mounted) {
ScaffoldMessenger.of(context).showSnackBar(
const SnackBar(content: Text('无效的购买记录ID'))
);
}
return;
}

final response = await _restClient.fallback
    .putUserBoughtApiV2LowAdminApiUserBoughtBoughtIdPut(
boughtId: boughtIdInt, // ❌ 错误：int 传给 String 参数
body: body,
);
```

**修改后：**

```dart

final response = await
_restClient.fallback
    .putUserBoughtApiV2LowAdminApiUserBoughtBoughtIdPut
(
boughtId: record.id, // ✅ 正确：直接使用 String 类型
body: body,
);
```

### 保持不变的部分

`_deleteBoughtRecord` 方法中的类型转换保持不变，因为 DELETE 接口确实需要 `int` 类型：

```dart

final boughtIdInt = int.tryParse(boughtId);if (
boughtIdInt == null) {
// ...validation
}

final result = await _restClient.fallback
    .deleteUserBoughtApiV2LowAdminApiUserBoughtBoughtIdDelete(
boughtId
:
boughtIdInt
, // ✅ 正确：DELETE 接口需要 int
);
```

## API 接口定义

```dart
// DELETE 接口 - 需要 int
@DELETE('/api/v2/low_admin_api/user_bought/{bought_id}')
Future<ErrorResponse> deleteUserBoughtApiV2LowAdminApiUserBoughtBoughtIdDelete({
  @Path('bought_id') required int boughtId,
});

// PUT 接口 - 需要 String
@PUT('/api/v2/low_admin_api/user_bought/{bought_id}')
Future<ErrorResponse> putUserBoughtApiV2LowAdminApiUserBoughtBoughtIdPut({
  @Path('bought_id') required String boughtId,
  @Body() required WebSubFastapiRoutersApiVLowAdminApiUserBoughtPutParamsModel body,
});
```

## 影响范围

- 文件：`lib/page/low_admin/user_bought_records/low_admin_user_bought_records_page.dart`
- 方法：`_editBoughtRecord`
- 功能：修复后可以正常编辑用户购买记录

## 测试建议

1. 进入用户购买记录页面
2. 点击编辑按钮
3. 修改商品ID、金额或购买时间
4. 保存修改
5. 验证修改是否成功
6. 测试删除功能是否正常工作

## 遵循的规范

✅ 避免无意义的类型转换和验证  
✅ 直接使用正确的类型  
✅ 保持代码简洁  
✅ 根据 API 定义使用正确的参数类型

