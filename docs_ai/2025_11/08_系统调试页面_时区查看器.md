# 系统调试页面 - 时区查看器

## 操作日期

2025年11月08日

## 功能概述

创建了系统调试模块，包含时区查看器功能，用于实时查看全球不同时区的时间信息。

## 文件结构

### 1. 二级页面 - 调试主页

**文件路径**: `/lib/page/system/debug/system_debug_page.dart`

**路由**: `/system/debug`

**功能描述**:

- 展示调试工具列表
- 提供时区查看器入口
- 预留系统信息、调试日志等功能入口
- 预留性能监控、内存使用等功能入口

**代码特点**:

- 使用 `StatelessWidget` 无状态组件
- 采用 Card 卡片布局，分类展示不同功能模块
- 使用 `context.go()` 进行路由跳转

### 2. 三级页面 - 时区查看器

**文件路径**: `/lib/page/system/debug/system_debug_view_timezone_page.dart`

**路由**: `/system/debug/view_timezone`

**功能描述**:

- 实时显示全球10个主要时区的当前时间
- 每秒自动刷新时间
- 显示时区偏移量（UTC offset）
- 高亮显示本地时区

**技术实现**:

1. **时区列表**:
    - 本地时区
    - 东京 (Asia/Tokyo)
    - 纽约 (America/New_York)
    - 伦敦 (Europe/London)
    - 巴黎 (Europe/Paris)
    - 悉尼 (Australia/Sydney)
    - 上海 (Asia/Shanghai)
    - 洛杉矶 (America/Los_Angeles)
    - 新加坡 (Asia/Singapore)
    - 迪拜 (Asia/Dubai)

2. **核心功能**:
   ```dart
   // 使用 Stream.periodic 实现每秒刷新
   _timeStream = Stream.periodic(
     const Duration(seconds: 1),
     (_) => DateTime.now(),
   );

   // 获取指定时区时间
   tz.TZDateTime _getTimezoneTime(String location) {
     if (location == 'local') {
       return tz.TZDateTime.now(tz.local);
     }
     final tz.Location tzLocation = tz.getLocation(location);
     return tz.TZDateTime.now(tzLocation);
   }

   // 计算时区偏移
   String _getTimezoneOffset(String location) {
     final tz.TZDateTime time = _getTimezoneTime(location);
     final Duration offset = time.timeZoneOffset;
     final int hours = offset.inHours;
     final int minutes = offset.inMinutes.remainder(60);
     final String sign = hours >= 0 ? '+' : '';
     return '$sign$hours:${minutes.toString().padLeft(2, '0')}';
   }
   ```

3. **UI 特点**:
    - 使用 `StreamBuilder` 实现实时更新
    - 本地时区使用边框高亮和"当前"标签
    - 使用等宽字体（monospace）显示时间
    - 卡片式布局，每个时区单独一个卡片
    - 底部说明卡片解释功能

## 路由配置

**文件路径**: `/lib/router/system_routes.dart`

```dart
GoRoute
(
path: '/system/debug',
name: 'system_debug',
builder: (context, state) => const SystemDebugPage(),
),
GoRoute(
path: '/system/debug/view_timezone',
name: 'system_debug_view_timezone',
builder: (context, state) => const SystemDebugViewTimezonePage(
)
,
)
,
```

## 菜单集成

**文件路径**: `/lib/component/layout/simple_layout_with_menu_component.dart`

在侧边栏菜单中添加了调试入口：

```dart

final List<_MenuItem> _otherMenuItems = [
  _MenuItem(
      icon: Icons.settings_outlined, label: '设置', route: '/system/settings'),
  _MenuItem(icon: Icons.bug_report_outlined, label: '调试', route: '/system/debug'),
  _MenuItem(icon: Icons.info_outline, label: '关于', route: '/about'),
];
```

## 依赖包

使用了已安装的 `timezone` 包：

```yaml
dependencies:
  timezone: ^0.9.0
```

## 使用说明

1. **访问调试页面**:
    - 点击侧边栏的"调试"菜单
    - 或直接访问路由 `/system/debug`

2. **查看时区**:
    - 在调试页面点击"时区查看器"
    - 或直接访问路由 `/system/debug/view_timezone`
    - 页面会自动每秒刷新显示最新时间

## 代码规范遵循

✅ 使用小写+下划线的文件命名  
✅ 类名使用大驼峰命名  
✅ 变量名使用小驼峰命名  
✅ 所有字段声明了明确类型  
✅ 使用 const 构造函数  
✅ 使用 `context.go()` 而非手动构造路由  
✅ 使用精简的代码实现功能  
✅ 2空格缩进  
✅ 使用尾逗号进行代码拆分

## 时间处理说明

- 使用 `timezone` 包的 `TZDateTime` 处理时区
- 使用 `intl` 包的 `DateFormat` 格式化时间显示
- 时间格式：`yyyy-MM-dd HH:mm:ss`
- 自动获取系统本地时区作为参考

## 后续扩展建议

1. 可添加更多调试工具：
    - 系统信息查看器
    - 调试日志查看器
    - 性能分析工具
    - 内存使用监控

2. 时区查看器可扩展：
    - 支持自定义添加时区
    - 支持时区搜索
    - 支持时间转换计算器
    - 支持时区对比分析

## 测试建议

1. 验证时间实时更新功能
2. 验证不同时区的时间正确性
3. 验证UTC偏移量计算准确性
4. 验证本地时区识别正确
5. 验证路由跳转正常
6. 验证菜单导航正常

