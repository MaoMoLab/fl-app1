# 旧服务商品列表页面UI优化

## 日期

2025年11月19日

## 操作说明

### 背景

旧服务商品列表页面需要与其他列表页面保持一致的UI风格，统一用户体验。

### 优化内容

#### 1. 搜索框改进

**原设计：**

- 标签：`搜索商品`
- 提示：`输入商品名称或ID`
- 搜索按钮：只在有输入时显示，独立一行显示

**新设计：**

- 标签：`查询参数 (q)`
- 提示：`例如: 商品名称 或留空查询所有`
- 帮助文本：`支持搜索商品名称或ID`
- 搜索按钮：始终显示，与输入框同一行

#### 2. 智能按钮

**新增功能：**

- 输入框为空时：显示 `🔄 全部`
- 输入框有内容时：显示 `🔍 搜索`
- 按钮状态根据输入自动切换

**实现代码：**

```dart
ElevatedButton.icon
(
onPressed: _isLoading ? null : _loadShops,
icon: Icon(_searchController.text.trim().isEmpty
? Icons.refresh
    : Icons.search),
label: Text(_searchController.text.trim().isEmpty
? '全部'
    : '搜索'
)
,
)
```

#### 3. UI布局优化

**原布局（2-3行）：**

```
┌────────────────────────────────────────┐
│ [🔍] 搜索商品: ___________  [×]        │
└────────────────────────────────────────┘
            ↓ (当有输入时)
┌────────────────────────────────────────┐
│           [🔍 搜索]                    │
└────────────────────────────────────────┘
```

**新布局（1行）：**

```
┌──────────────────────────────────────┬──────────────┐
│ [🔍] 查询参数 (q): 商品名称      [×] │ [🔍 搜索]    │
│     支持搜索商品名称或ID             │              │
└──────────────────────────────────────┴──────────────┘
```

**空状态时：**

```
┌──────────────────────────────────────┬──────────────┐
│ [🔍] 查询参数 (q): ___________      │ [🔄 全部]    │
│     支持搜索商品名称或ID             │              │
└──────────────────────────────────────┴──────────────┘
```

#### 4. 新增下拉刷新

**原实现：**

```dart
return ListView
.
builder
(
controller
:
_scrollController
,
// ...
);
```

**新实现：**

```dart
return RefreshIndicator(
onRefresh: _loadShops,
child: ListView.builder(
controller
:
_scrollController
,
// ...
)
,
);
```

**优势：**

- ✅ 用户可以下拉刷新商品列表
- ✅ 提升用户体验
- ✅ 与其他列表页面保持一致

#### 5. 清空优化

**原实现：**

```dart
IconButton
(
icon: const Icon(Icons.clear),
onPressed: () {
_searchController.clear();
setState(() {}); // 仅清空，不刷新
},
)
```

**新实现：**

```dart
IconButton
(
icon: const Icon(Icons.clear),
onPressed: () {
_searchController.clear();
_loadShops(); // ✅ 清空并自动刷新
},
)
```

**优势：**

- ✅ 一键完成清空和刷新
- ✅ 减少用户操作步骤
- ✅ 更符合用户预期

#### 6. 空状态提示优化

**原提示：**

```dart
Text
('暂无商品数据
'
,style: TextStyle(fontSize: 18, color: Colors.
grey
[
600
]
)
,
)
,
```

**新提示：**

```dart
Column
(
children: [
Icon(
Icons.shopping_bag_outlined,
size: 80,
color: Colors.grey[400],
),
const SizedBox(height: 16),
Text(
'暂无商品数据',
style: TextStyle(fontSize: 18, color: Colors.grey[600]),
),
const SizedBox(height: 8),
Text(
'输入查询参数搜索，支持搜索商品名称或ID',
style: TextStyle(fontSize: 14, color: Colors.grey[500]),
textAlign: TextAlign.center,
),
],
)
```

**优势：**

- ✅ 添加了帮助文本
- ✅ 提示用户如何使用搜索功能
- ✅ 更友好的用户引导

### 与其他页面的一致性

现在旧服务商品列表页面与其他列表页面完全一致：

| 特性     | 用户列表       | 购买记录       | 充值记录       | 商品列表       |
|--------|------------|------------|------------|------------|
| 搜索框标签  | `查询参数 (q)` | `查询参数 (q)` | `查询参数 (q)` | `查询参数 (q)` |
| 帮助文本   | ✅          | ✅          | ✅          | ✅          |
| 智能按钮   | ✅          | ✅          | ✅          | ✅          |
| 清空自动刷新 | ✅          | ✅          | ✅          | ✅          |
| 下拉刷新   | ❌          | ✅          | ✅          | ✅          |
| 单行布局   | ✅          | ✅          | ✅          | ✅          |

### 商品详情对话框

页面保留了完整的商品详情和编辑功能：

**查看功能：**

- 点击任意商品卡片打开详情对话框
- 显示所有商品信息（基本信息、流量、等级、有效期等）
- 显示创建和更新时间

**编辑功能：**

- 点击编辑按钮进入编辑模式
- 可编辑所有字段：
    - 商品名称
    - 价格
    - 商品类型（下拉选择）
    - 流量大小
    - 等级和有效期
    - 各种配置开关
- 保存后自动刷新列表

### 商品卡片显示

每个商品卡片包含：

**基本信息：**

- 商品图标
- 商品名称
- 商品类型（主套餐/附加套餐/签到套餐/负面套餐）
- 启用/禁用状态标签

**详细信息：**

- 商品ID
- 价格
- 等级
- 流量大小（自动格式化为 B/KB/MB/GB/TB）
- 等级有效期
- 账户有效期
- 创建时间

**交互：**

- 点击卡片打开详情对话框
- 右侧显示箭头图标提示可点击

### 使用场景

#### 场景1：查看所有商品

1. 清空搜索框或直接点击"全部"
2. 显示所有商品列表
3. 可以下拉刷新

#### 场景2：搜索特定商品

1. 在搜索框输入商品名称或ID
2. 点击"搜索"或按回车
3. 显示匹配的商品

#### 场景3：编辑商品信息

1. 点击商品卡片打开详情
2. 点击编辑按钮
3. 修改信息
4. 点击保存
5. 自动刷新列表

#### 场景4：快速刷新

1. 下拉列表进行刷新
2. 或点击"全部"按钮刷新

### 代码统计

| 指标        | 修改前      | 修改后   | 变化    |
|-----------|----------|-------|-------|
| **UI元素数** | 可变（1-2个） | 固定 2个 | 统一    |
| **布局行数**  | 2-3 行    | 1 行   | 简化    |
| **下拉刷新**  | ❌        | ✅     | +1 功能 |
| **清空操作**  | 2 步      | 1 步   | -50%  |

### 特殊功能保留

旧服务商品列表有一些特殊的功能，这次优化完全保留：

1. **字节格式化**
   ```dart
   String _formatBytes(int? bytes) {
     // 自动转换为 B/KB/MB/GB/TB
   }
   ```

2. **商品类型映射**
   ```dart
   String _getShopTypeName(ShopTypeEnum type) {
     // 枚举值转换为中文名称
   }
   ```

3. **完整的编辑对话框**
    - 支持所有字段编辑
    - 数据验证
    - 保存确认
    - 自动刷新

4. **时间本地化显示**
   ```dart
   tz.TZDateTime.from(shop.createdAt!, tz.local)
   ```

### 总结

此次优化实现了：

- ✅ **UI统一** - 与所有列表页面保持一致
- ✅ **体验提升** - 智能按钮、下拉刷新、清空自动刷新
- ✅ **布局优化** - 单行布局，更简洁
- ✅ **功能保留** - 完整保留商品编辑功能
- ✅ **提示优化** - 更友好的空状态提示

旧服务商品列表页面现在拥有与其他列表页面完全一致的用户体验！

